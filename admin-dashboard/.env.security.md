# Environment Variables Security Guide

## Overview

Default passwords for pre-configured accounts are now stored in environment variables instead of being hardcoded in the source code. This enhances security by keeping sensitive credentials out of version control.

---

## Setup Instructions

### 1. Copy the Example File

```bash
cp .env.example .env
```

### 2. Configure Default Passwords

Edit the `.env` file and set the pre-configured account passwords:

```env
# Pre-configured Account Passwords (KEEP SECURE - DO NOT COMMIT .env FILE)
# These are temporary passwords that MUST be changed on first login
VITE_DEFAULT_PASSWORD_TAGBILARAN=ChanceryTagbilaran2025!
VITE_DEFAULT_PASSWORD_TALIBON=ChanceryTalibon2025!
VITE_DEFAULT_PASSWORD_HERITAGE=HeritageResearcher2025!
```

### 3. Verify .gitignore

Ensure `.env` is in `.gitignore` (already configured):

```gitignore
# Environment variables
.env
.env.local
.env.*.local
```

---

## Security Best Practices

### DO ✅
- **Keep `.env` file secure** - Never commit to git
- **Use strong passwords** - Minimum requirements enforced
- **Rotate passwords regularly** - Change every 90-180 days
- **Share securely** - Use encrypted channels only
- **Document changes** - Track who has access
- **Backup securely** - Store in password manager

### DON'T ❌
- **Never commit `.env`** - It contains sensitive credentials
- **Never email passwords** - Use secure channels
- **Never share publicly** - Keep private
- **Never reuse passwords** - Each environment should differ
- **Never store in plain text** - Use password managers

---

## Environment-Specific Configuration

### Development Environment

```env
# Development - Use test passwords
VITE_DEFAULT_PASSWORD_TAGBILARAN=DevTagbilaran2025!
VITE_DEFAULT_PASSWORD_TALIBON=DevTalibon2025!
VITE_DEFAULT_PASSWORD_HERITAGE=DevHeritage2025!
```

### Staging Environment

```env
# Staging - Use staging-specific passwords
VITE_DEFAULT_PASSWORD_TAGBILARAN=StagingTagbilaran2025!
VITE_DEFAULT_PASSWORD_TALIBON=StagingTalibon2025!
VITE_DEFAULT_PASSWORD_HERITAGE=StagingHeritage2025!
```

### Production Environment

```env
# Production - Use strong, unique passwords
VITE_DEFAULT_PASSWORD_TAGBILARAN=[GENERATE_STRONG_PASSWORD]
VITE_DEFAULT_PASSWORD_TALIBON=[GENERATE_STRONG_PASSWORD]
VITE_DEFAULT_PASSWORD_HERITAGE=[GENERATE_STRONG_PASSWORD]
```

---

## Password Requirements

All passwords must meet these requirements:
- ✅ Minimum **8 characters**
- ✅ At least **one uppercase letter** (A-Z)
- ✅ At least **one lowercase letter** (a-z)
- ✅ At least **one number** (0-9)
- ✅ At least **one special character** (!@#$%^&*)

### Generate Strong Passwords

Use a password generator:

```bash
# Using OpenSSL (Linux/Mac)
openssl rand -base64 32

# Using PowerShell (Windows)
Add-Type -AssemblyName System.Web
[System.Web.Security.Membership]::GeneratePassword(16, 4)
```

Or use online tools:
- 1Password Password Generator
- LastPass Password Generator
- Bitwarden Password Generator

---

## Files That Use Environment Variables

The following files read from environment variables:

1. **setup-accounts.ts**
   - Creates pre-configured accounts
   - Uses `VITE_DEFAULT_PASSWORD_*` variables

2. **check-accounts.ts**
   - Validates existing accounts
   - Uses `VITE_DEFAULT_PASSWORD_*` variables

3. **setup-museum-researcher.ts**
   - Sets up museum researcher account
   - Uses `VITE_DEFAULT_PASSWORD_HERITAGE`

---

## Fallback Mechanism

If environment variables are not set, the code falls back to hardcoded defaults:

```typescript
password: import.meta.env.VITE_DEFAULT_PASSWORD_TAGBILARAN || 'ChanceryTagbilaran2025!'
```

**Warning**: Fallback passwords are still in source code as a safety mechanism. For maximum security:
1. Always set environment variables
2. Consider removing fallback values in production builds

---

## Deployment Checklist

### Pre-Deployment
- [ ] Create `.env` file from `.env.example`
- [ ] Generate strong, unique passwords
- [ ] Set all `VITE_DEFAULT_PASSWORD_*` variables
- [ ] Verify `.env` is in `.gitignore`
- [ ] Test build with environment variables

### During Deployment
- [ ] Copy `.env` to production server
- [ ] Set appropriate file permissions (600 or 400)
- [ ] Verify environment variables are loaded
- [ ] Test account creation scripts

### Post-Deployment
- [ ] Document passwords in password manager
- [ ] Share credentials securely with users
- [ ] Monitor for successful first logins
- [ ] Verify users changed passwords

---

## Troubleshooting

### Environment Variables Not Loading

**Symptom**: Fallback passwords being used

**Solution**:
1. Check `.env` file exists in `admin-dashboard/` directory
2. Verify variable names match exactly: `VITE_DEFAULT_PASSWORD_*`
3. Restart development server: `npm run dev`
4. Clear build cache: `npm run clean && npm run build`

### Build Errors

**Symptom**: Build fails with "Cannot read env variable"

**Solution**:
1. Ensure Vite prefix: All variables must start with `VITE_`
2. Check `.env` file syntax (no spaces around `=`)
3. Verify quotes if password contains special characters

### Account Creation Fails

**Symptom**: "Invalid password" error during setup

**Solution**:
1. Verify password meets Firebase requirements
2. Check for trailing spaces in `.env` file
3. Ensure no special characters that break parsing

---

## CI/CD Integration

### GitHub Actions

```yaml
# .github/workflows/deploy.yml
- name: Create .env file
  run: |
    echo "VITE_DEFAULT_PASSWORD_TAGBILARAN=${{ secrets.DEFAULT_PASSWORD_TAGBILARAN }}" >> .env
    echo "VITE_DEFAULT_PASSWORD_TALIBON=${{ secrets.DEFAULT_PASSWORD_TALIBON }}" >> .env
    echo "VITE_DEFAULT_PASSWORD_HERITAGE=${{ secrets.DEFAULT_PASSWORD_HERITAGE }}" >> .env
```

### Firebase Hosting

```bash
# Set environment variables in Firebase
firebase functions:config:set passwords.tagbilaran="ChanceryTagbilaran2025!"
firebase functions:config:set passwords.talibon="ChanceryTalibon2025!"
firebase functions:config:set passwords.heritage="HeritageResearcher2025!"
```

---

## Security Audit

### Regular Reviews
- **Weekly**: Check `.env` file permissions
- **Monthly**: Review who has access to credentials
- **Quarterly**: Rotate all default passwords
- **Yearly**: Complete security audit

### Access Control
Track who has access to `.env` file:

| Person | Role | Access Level | Date Granted |
|--------|------|--------------|--------------|
| IT Admin | Administrator | Full | YYYY-MM-DD |
| Chancery | User | Read-only | YYYY-MM-DD |

---

## Emergency Procedures

### If Credentials Are Compromised

1. **Immediate Actions**:
   - Disable affected accounts in Firebase Auth
   - Change passwords in `.env` file
   - Force password reset for all users
   - Review audit logs

2. **Investigation**:
   - Identify how credentials were exposed
   - Check for unauthorized access
   - Review recent changes to data

3. **Recovery**:
   - Generate new strong passwords
   - Update `.env` file
   - Notify affected users
   - Document incident

---

## Related Documentation

- [Forced Password Change Feature](../docs/FORCED_PASSWORD_CHANGE.md)
- [Security Improvements](../docs/SECURITY_IMPROVEMENTS.md)
- [Deployment Guide](../docs/DEPLOYMENT.md)

---

**Last Updated**: 2025-01-10
**Security Level**: HIGH
**Review Required**: Quarterly
